<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrix Snake Game</title>
    <style>
        /* ... (το υπάρχον CSS παραμένει το ίδιο) ... */
    </style>
</head>
<body>
    <div id="wallet-container">
        <button id="connect-button">Connect Wallet</button>
        <button id="disconnect-button" style="display: none;">Disconnect</button>
        <button id="switch-network" style="display: none;">Switch to Polygon</button>
        <span id="wallet-address"></span>
    </div>

    <h1>Matrix Snake Game</h1>
    <div id="info">
        <span id="hearts">❤️❤️❤️</span>
        <span>Pills: <span id="pill-count">0</span></span>
    </div>
    <div id="game-container"></div>
    <div id="controls">
        <button id="start-button">Start</button>
        <button id="lose-button">Lose</button>
    </div>
    <div id="high-score">High Score: <span id="high-score-value">0</span></div>

    <!-- Game Pad για κινητές συσκευές -->
    <div id="game-pad">
        <button id="up-button">⬆️</button>
        <button id="down-button">⬇️</button>
        <button id="left-button">⬅️</button>
        <button id="right-button">➡️</button>
    </div>

    <script>
        let snake, direction, pills, gameLoop, speed;
        let hearts = 3;
        let pillCount = 0;
        let highScore = 0;
        const gameContainer = document.getElementById("game-container");
        const pillCounter = document.getElementById("pill-count");
        const heartsDisplay = document.getElementById("hearts");
        const highScoreDisplay = document.getElementById("high-score-value");

        // URL του Google Apps Script Web App
        const googleScriptUrl = "https://script.google.com/macros/s/AKfycbxNVuSVzUvzUTH25NT4bUTZdx_YkoHWGktzNtpe_mPtldpmBUYzdm6UELp9EjeR91_SwQ/exec"; // Αντικατέστησε με το URL σου

        // Συνάρτηση για αποθήκευση δεδομένων στο Google Sheet
        async function saveToGoogleSheet(walletAddress, highScore) {
            const data = {
                walletAddress: walletAddress,
                highScore: highScore
            };

            try {
                const response = await fetch(googleScriptUrl, {
                    method: "POST",
                    body: JSON.stringify(data),
                    headers: {
                        "Content-Type": "application/json"
                    }
                });
                const result = await response.text();
                console.log(result); // Εμφάνιση αποτελέσματος στην κονσόλα
            } catch (error) {
                console.error("Error saving data:", error);
            }
        }

        // ... (το υπάρχον JavaScript παραμένει το ίδιο) ...

        // Όταν ενημερώνεται το high score
        function checkPillCollision() {
            for (let i = 0; i < pills.length; i++) {
                if (snake[0].x === pills[i].x && snake[0].y === pills[i].y) {
                    pills[i].element.remove();
                    pills.splice(i, 1);
                    pillCount++;
                    pillCounter.innerText = pillCount;
                    speed *= 0.99;
                    clearInterval(gameLoop);
                    gameLoop = setInterval(moveSnake, speed);
                    spawnPill();

                    if (pillCount > highScore) {
                        highScore = pillCount;
                        highScoreDisplay.innerText = highScore;

                        // Αποθήκευση στο Google Sheet αν ο χρήστης είναι συνδεδεμένος
                        const walletAddress = document.getElementById("wallet-address").innerText;
                        if (walletAddress) {
                            saveToGoogleSheet(walletAddress, highScore);
                        }
                    }
                    return true;
                }
            }
            return false;
        }

        // ... (το υπόλοιπο JavaScript παραμένει το ίδιο) ...
    </script>
</body>
</html>
